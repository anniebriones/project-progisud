---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hreflang from '~/components/Hreflang.astro';
import SeoSchema from "../components/SeoSchema.astro";

const images = [
  "/images/about/01.png",
  "/images/about/02.png",
  "/images/about/03.png",
  "/images/about/04.png",
  "/images/about/01.png",
  "/images/about/02.png"
];

const title = 'Progisud Digital Partner'
const description = 'Progisud is a SAP Tech Start-up, working on modern solutions like SAP PUBLIC CLOUD, Business AI, BTP Technologies and expanding our expertise to the entire IT transformation.'
const image = 'https://progisud-digital-partner.fr/images/progisud-logo.jpg'

const perSlideSec = 4;     // seconds each slide is shown
const transitionMs = 600;  // slide animation duration (ms)

const site = 'https://progisud-digital-partner.fr';
const pageUrl = `${site}/`;

const org = {
  name: "Progisud Digital Partner",
  url: site,
  logoUrl: "https://progisud-digital-partner.fr/images/progisud.png",
  logoW: 512,
  logoH: 512,

  // 1) About Us
  description,

  // 2) Our Team (descriptions only)
  teamNotes: [
    "Progisud is composed exclusively of SENIOR or EXPERT profiles based in France or in our Delivery Center in Manila, Philippines.",
    "This allows us to cover time slots on all continents."
  ],

  // 3) Our Services
  services: [
    { name: "SAP S/4HANA Cloud Implementation", description: "End-to-end implementation and migration for SAP S/4HANA Cloud Public and Private editions." },
    { name: "SAP Business Technology Platform (BTP)", description: "Custom extensions, integrations, and AI-driven apps on SAP BTP." },
    { name: "SAP Integration & Consulting", description: "Consulting for SAP PUBLIC CLOUD, Finance, and third-party integrations." }
  ],

  // 4) Localization (offices)
  locations: [
    {
      name: "Progisud – Marseille Office",
      streetAddress: "18 chemin de Mimet",
      postalCode: "13015",
      addressLocality: "Marseille",
      addressCountry: "FR",
      email: "contact@progisud.com"
    },
    {
      name: "Progisud – Manila Office",
      streetAddress: "10th Floor, South Tower Rockwell Business Center, Sheridan",
      addressLocality: "Mandaluyong City",
      addressCountry: "PH",
      email: "contact@progisud.com"
    }
  ],

  // 5) Contact Us
  contactEmail: "contact@progisud.com"
};

const page = {
  url: pageUrl,
  pageType: 'AboutPage',
  name: 'About Us | Progisud',
  description
};
---

<BaseLayout {title} {description} {image} lang="en">
<SeoSchema {org} {page} includeWebsite={true} />

  <section class="relative h-[28rem] overflow-hidden">
    <!-- Static background image -->
    <img
      src="/images/background/aubg-01.png"
      alt=""
      class="absolute inset-0 w-full h-full object-cover"
      loading="lazy"
    />

    <!-- Gray overlay covering 75% from left (stays static too) -->
    <div class="absolute inset-0 bg-gradient-to-r from-gray-800/70 via-gray-800/70 to-transparent mix-blend-multiply"></div>

    <!-- Text (flies in) -->
    <div class="relative z-10 mx-auto max-w-6xl px-4 md:px-8 h-full flex flex-col justify-center">
      <h3 data-fly class="text-2xl md:text-3xl font-bold text-white">
        Progisud : Where Innovation Meets Expertise
      </h3>
    </div>
  </section>

  <!-- About us -->
  <div class="mx-auto max-w-3xl text-center mt-16 space-y-12">
    <section data-reveal>
      <h1 class="text-3xl font-bold" data-reveal>About Us</h1>
      <p class="mt-4 text-gray-700" data-reveal>
        At Progisud, our strength lies in our community, which is made up exclusively of senior and expert.
        Our team can discuss truly and understand your expectations to support you in your digital transformation.
      </p>
    </section>
  </div>

  <!-- Scrollable images -->
  <section
    id="hero-slider"
    class="mt-16 relative w-full overflow-hidden select-none flex justify-center"
    data-total={images.length}
    data-per-slide={perSlideSec}
    data-transition={transitionMs}
  >
    <ul id="slider-track"
        class="m-0 p-0 list-none flex gap-4 h-[28rem] md:h-[32rem]"
        style="transform: translateX(0);">
      {images.map((src) => (
        <li class="shrink-0 w-[80%] md:w-[30rem] h-full rounded-xl overflow-hidden shadow-lg">
          <img src={src} alt="" class="w-full h-full object-cover" loading="lazy" />
        </li>
      ))}
    </ul>
  </section>

  <!-- Public Edition expertise -->
  <div class="mx-auto max-w-3xl text-center mt-16 space-y-12">
    <section data-reveal>
      <h2 class="text-2xl font-semibold">Explore Our SAP S/4HANA Public Edition expertise</h2>
      <p class="mt-3 text-gray-700">
        Accelerate the implementation of S/4HANA Public Edition thanks to our Return of Experience to deliver your project on time and on budget.
      </p>
    </section>
  </div>

  <!-- Why choose us -->
  <div class="mx-auto max-w-3xl text-center mt-16 space-y-12">
    <!-- Why Choose Us -->
    <section data-reveal>
      <h2 class="text-2xl font-semibold">Why choose us</h2>
      <p class="mt-3 text-gray-700">
        Our methodology covers the entire scope of the digital transformation process.
      </p>
    </section>
  </div>

  <!-- Background image + text -->
  <section class="mt-16 relative h-[28rem] overflow-hidden">
    <img src="/images/background/aubg-02.jpeg"
        alt=""
        class="absolute inset-0 w-full h-full object-cover" />

    <!-- Gray overlay covering 75% of the image from left -->
    <div class="absolute inset-0 bg-gradient-to-r from-gray-800/70 via-gray-800/70 to-transparent mix-blend-multiply"></div>

    <div class="relative z-10 mx-auto max-w-6xl px-4 md:px-8 h-full flex flex-col justify-center">
      <h3 class="text-2xl md:text-3xl font-bold text-white">Your trusted partner for <br/> seamless SAP S/4HANA implementation</h3>
    </div>
  </section>

  <!-- Chrono Section -->
  <section class="mt-16 relative left-1/2 right-1/2 -mx-[50vw] w-screen bg-sky-700 py-40">
    <div class="mx-auto max-w-6xl px-4 md:px-8 text-center">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 
                  gap-12 lg:gap-0 
                  lg:divide-x lg:divide-white/30 
                  [&>div]:lg:px-8">
        
        <div>
          <div class="text-5xl font-extrabold text-white counter" data-to="55" data-suffix="+">0+</div>
          <p class="mt-2 text-white/90">Employees</p>
        </div>

        <div>
          <div class="text-5xl font-extrabold text-white counter" data-to="20" data-suffix="+">0+</div>
          <p class="mt-2 text-white/90">Years of Experience</p>
        </div>

        <div>
          <div class="text-5xl font-extrabold text-white counter" data-to="30" data-suffix="+">0+</div>
          <p class="mt-2 text-white/90">Happy Customers</p>
        </div>

        <div>
          <div class="text-5xl font-extrabold text-white counter" data-to="1" data-prefix="<" data-suffix="%" data-final-override="<1%">0%</div>
          <p class="mt-2 text-white/90">Turn Over</p>
        </div>

      </div>
    </div>
  </section>

  <!-- Core & Values -->
  <section class="relative left-1/2 right-1/2 -mx-[50vw] w-screen bg-blue-50 py-16">
    <div class="mx-auto max-w-6xl px-4 md:px-8 text-center">
      <h2 class="text-3xl font-bold mb-10">Our Core Values</h2>

      <!-- Row 1: 3 tiles -->
      <div class="grid gap-10 md:grid-cols-3 mb-10">
        <div class="flex flex-col h-full min-h-[20rem] p-6 rounded-2xl bg-white shadow-md">
          <svg xmlns="http://www.w3.org/2000/svg" class="mt-6 w-12 h-12 mx-auto text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <circle cx="12" cy="7" r="4"/><path d="M3 21c2.5-4 7-5 9-5s6.5 1 9 5"/>
          </svg>
          <h4 class="text-xl mt-6 font-bold">Client-Centric Innovation</h4>
          <p class="mt-4 text-gray-700">We prioritize our clients' unique challenges, crafting personalized and innovative solutions.</p>
          <div class="mt-auto"></div>
        </div>

        <div class="flex flex-col h-full min-h-[20rem] p-6 rounded-2xl bg-white shadow-md">
          <svg xmlns="http://www.w3.org/2000/svg" class="mt-6 w-12 h-12 mx-auto text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <polygon points="12 2 15 9 22 9 17 14 19 22 12 18 5 22 7 14 2 9 9 9"/>
          </svg>
          <h4 class="text-xl mt-6 font-bold">Dedication to Quality</h4>
          <p class="mt-4 text-gray-700">Whether it's software development or consulting services, we ensure that quality is never compromised.</p>
          <div class="mt-auto"></div>
        </div>

        <div class="flex flex-col h-full min-h-[20rem] p-6 rounded-2xl bg-white shadow-md">
          <svg xmlns="http://www.w3.org/2000/svg" class="mt-6 w-12 h-12 mx-auto text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
          <h4 class="text-xl mt-6 font-bold">Dynamic Mindset</h4>
          <p class="mt-4 text-gray-700">
            Our strength lies in our team. We invest in their growth and skills, promoting synergy between areas to deliver the best solution quickly.
          </p>
          <div class="mt-auto"></div>
        </div>
      </div>

      <!-- Row 2: 2 tiles centered -->
      <div class="flex flex-wrap justify-center gap-8">
        <div class="flex flex-col h-full min-h-[20rem] w-full md:w-1/3 p-6 rounded-2xl bg-white shadow-md">
          <svg xmlns="http://www.w3.org/2000/svg" class="mt-6 w-12 h-12 mx-auto text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <polygon points="12 3 3 8 12 13 21 8 12 3"/><polyline points="3 12 12 17 21 12"/><polyline points="3 16 12 21 21 16"/>
          </svg>
          <h4 class="text-xl mt-6 font-bold">Our Community</h4>
          <p class="mt-4 text-gray-700">Priority given to our ecosystem of consultants. Our team has a strong appetite for innovation.</p>
          <div class="mt-auto"></div>
        </div>

        <div class="flex flex-col h-full min-h-[20rem] w-full md:w-1/3 p-6 rounded-2xl bg-white shadow-md">
          <svg xmlns="http://www.w3.org/2000/svg" class="mt-6 w-12 h-12 mx-auto text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path d="M20 13l-7 7-9-9 7-7h6l3 3v6z"/><circle cx="16.5" cy="7.5" r="1.5"/>
          </svg>
          <h4 class="text-xl mt-6 font-bold">Competitive Rates</h4>
          <p class="mt-4 text-gray-700">Thanks to our delivery center based in the Philippines, we offer very competitive rates.</p>
          <div class="mt-auto"></div>
        </div>
      </div>
    </div>
  </section>

  <script is:inline type="module">
    // Respect "Reduce Motion"
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // Fly-in reveal
    const revealEls = document.querySelectorAll('[data-reveal]');
    if (!prefersReduced && 'IntersectionObserver' in window) {
      revealEls.forEach(el => {
        el.style.transition = 'opacity 600ms ease, transform 1600ms ease';
        el.style.opacity = '0';
        el.style.transform = 'translateY(16px)';
      });
      const io = new IntersectionObserver((entries) => {
        entries.forEach(({isIntersecting, target}) => {
          if (isIntersecting) {
            target.style.opacity = '1';
            target.style.transform = 'translateY(0)';
            io.unobserve(target);
          }
        });
      }, { threshold: 1 });
      revealEls.forEach(el => io.observe(el));
    }

    // Horizontal drag-to-scroll (desktop) for the gallery
    const strip = document.getElementById('image-strip');
    if (strip) {
      let isDown = false, startX = 0, scrollLeft = 0;
      strip.addEventListener('mousedown', (e) => {
        isDown = true;
        startX = e.pageX - strip.offsetLeft;
        scrollLeft = strip.scrollLeft;
        strip.classList.add('active');
        e.preventDefault();
      });
      window.addEventListener('mouseup', () => { isDown = false; strip.classList.remove('active'); });
      strip.addEventListener('mouseleave', () => { isDown = false; strip.classList.remove('active'); });
      strip.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        const x = e.pageX - strip.offsetLeft;
        const walk = (x - startX);
        strip.scrollLeft = scrollLeft - walk;
      });
    }

    // Count-up with easing, prefixes/suffixes, and optional final override (e.g., "<1%")
    const counters = document.querySelectorAll('.counter');
    if ('IntersectionObserver' in window) {
      const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3);

      const ci = new IntersectionObserver((entries) => {
        entries.forEach(({ isIntersecting, target }) => {
          if (!isIntersecting) return;

          const end = parseFloat(target.getAttribute('data-to') || '0');
          const dur = parseInt(target.getAttribute('data-duration') || '1000', 10);
          const prefix = target.getAttribute('data-prefix') || '';
          const suffix = target.getAttribute('data-suffix') || '';
          const decimals = parseInt(target.getAttribute('data-decimals') || '0', 10);
          const finalOverride = target.getAttribute('data-final-override');

          const start = 0;
          const startTime = performance.now();

          function tick(now) {
            const raw = Math.min(1, (now - startTime) / dur);
            const p = easeOutCubic(raw);
            const current = start + (end - start) * p;

            let formatted = decimals > 0
              ? current.toFixed(decimals)
              : Math.floor(current).toString();

            target.textContent = `${prefix}${formatted}${suffix}`;

            if (raw < 1) {
              requestAnimationFrame(tick);
            } else {
              // On completion, lock exact target — or use final override (e.g., "<1%")
              if (finalOverride) {
                target.textContent = finalOverride;
              } else {
                const endFormatted = decimals > 0 ? end.toFixed(decimals) : Math.floor(end).toString();
                target.textContent = `${prefix}${endFormatted}${suffix}`;
              }
            }
          }

          requestAnimationFrame(tick);
          ci.unobserve(target);
        });
      }, { threshold: 0.3 });

      counters.forEach((c) => ci.observe(c));
    }

    const flyEls = document.querySelectorAll('[data-fly]');

    if (!prefersReduced && 'IntersectionObserver' in window) {
      // Initial state
      flyEls.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(18px)';
        el.style.transition = 'opacity 600ms ease, transform 600ms ease';
      });

      const io = new IntersectionObserver(entries => {
        entries.forEach(({ isIntersecting, target }) => {
          if (!isIntersecting) return;
          target.style.opacity = '1';
          target.style.transform = 'translateY(0)';
          io.unobserve(target);
        });
      }, { threshold: 0.15 });

      flyEls.forEach(el => io.observe(el));
    }

    const fadeEls = document.querySelectorAll('[data-fade]');
    if ('IntersectionObserver' in window) {
      fadeEls.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(16px)';
        el.style.transition = 'opacity 700ms ease, transform 700ms ease';
      });

      const io = new IntersectionObserver(entries => {
        entries.forEach(({ isIntersecting, target }) => {
          if (isIntersecting) {
            target.style.opacity = '1';
            target.style.transform = 'translateY(0)';
            io.unobserve(target);
          }
        });
      }, { threshold: 0.15 });

      fadeEls.forEach(el => io.observe(el));
    }

    // Images
    const section = document.getElementById('hero-slider');
    const track = section.querySelector('#slider-track');

    const TOTAL = Number(section.dataset.total ?? 1);
    const PER_SLIDE = Number(section.dataset.perSlide ?? 4);
    const TRANSITION = Number(section.dataset.transition ?? 600);

    function getGapPx() {
      const gap = getComputedStyle(track).gap || '0px';
      return parseFloat(gap);
    }

    // Clone first/last for seamless loop
    function setupClones() {
      const slides = Array.from(track.children);
      if (!slides.length) return;

      const first = slides[0].cloneNode(true);
      const last  = slides[slides.length - 1].cloneNode(true);

      first.setAttribute('data-clone', 'first');
      last.setAttribute('data-clone', 'last');

      track.insertBefore(last, slides[0]);   // prepend last clone
      track.appendChild(first);              // append first clone
    }

    // Current index in the *DOM* after cloning (0..TOTAL+1), start at 1
    let index = 1;
    let timer;
    let gapPx = 2;
    let slideW = 0;

    function measure() {
      gapPx = getGapPx();
      // All slides share same width; measure one real slide (index 1 after clones)
      const ref = track.children[1];
      slideW = ref ? ref.offsetWidth : section.clientWidth;
      // Set track width (N real + 2 clones)
      track.style.width = `${(TOTAL + 2) * (slideW + gapPx)}px`;
    }

    function applyTransform(withTransition = true) {
      track.style.transition = withTransition ? `transform ${TRANSITION}ms ease-in-out` : 'none';
      track.style.transform = `translateX(-${index * (slideW + gapPx)}px)`;
    }

    function go(i) {
      index = i;
      applyTransform(true);
    }

    // add near your other state vars
    let autoCount = 0; // how many auto-scrolls in the current cycle

    function start() {
      stop();
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        timer = setInterval(() => {
          if (autoCount < 2) {
            go(index + 1);     // move 1 slide
            autoCount++;
          } else {
            // after 2 moves, jump back to first real slide and restart the cycle
            autoCount = 0;
            index = 1;
            applyTransform(false); // snap without animation
          }
        }, PER_SLIDE * 1000); // still your delay between moves (in seconds)
      }
    }

    function stop() {
      if (timer) clearInterval(timer);
      timer = null;
      autoCount = 0; // optional: reset the cycle when paused
    }


    // Seamless jump after finishing transition on a clone
    track.addEventListener('transitionend', () => {
      const child = track.children[index];
      if (!child) return;

      if (child.getAttribute('data-clone') === 'first') {
        // jumped past the last real slide -> snap to first real (index 1)
        index = 1;
        applyTransform(false);
      } else if (child.getAttribute('data-clone') === 'last') {
        // jumped before the first real slide -> snap to last real (index TOTAL)
        index = TOTAL;
        applyTransform(false);
      }
    });

    // Pointer swipe
    let dragging = false, startX = 0, deltaX = 0;

    section.addEventListener('pointerdown', (e) => {
      dragging = true;
      startX = e.clientX;
      deltaX = 0;
      stop();
      applyTransform(false);
      section.setPointerCapture(e.pointerId);
    });
    section.addEventListener('pointermove', (e) => {
      if (!dragging) return;
      deltaX = e.clientX - startX;
      const base = -index * (slideW + gapPx);
      track.style.transform = `translateX(${base + deltaX}px)`;
    });

    function endDrag(e) {
      if (!dragging) return;
      dragging = false;
      try { section.releasePointerCapture(e.pointerId); } catch {}

      // Threshold: swipe at least 20% of slide width
      const threshold = slideW * 0.2;
      if (deltaX <= -threshold) go(index + 1);
      else if (deltaX >= threshold) go(index - 1);
      else applyTransform(true); // snap back

      start();
    }
    section.addEventListener('pointerup', endDrag);
    section.addEventListener('pointercancel', endDrag);

    // Pause on hover
    section.addEventListener('mouseenter', stop);
    section.addEventListener('mouseleave', start);

    // Resize handling
    window.addEventListener('resize', () => {
      const prev = index;
      measure();
      index = prev; // keep same slide
      applyTransform(false);
    });

    // Init
    setupClones();
    measure();
    // Start at first real slide (index 1)
    applyTransform(false);
    start();
  </script>
</BaseLayout>