---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Contact Us" description="Get in touch" lang="en">
  <h1 class="text-3xl font-bold">Contact Us</h1>

  <form id="contactForm" class="mt-6 max-w-xl space-y-4 mb-10">
    <!-- First & Last Name -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <input 
          class="w-full rounded-lg border p-3" 
          placeholder="First Name *" 
          name="firstName" 
          required
        />
        <p class="text-red-500 text-sm hidden">First name is required.</p>
      </div>
      <div>
        <input 
          class="w-full rounded-lg border p-3" 
          placeholder="Last Name *" 
          name="lastName" 
          required
        />
        <p class="text-red-500 text-sm hidden">Last name is required.</p>
      </div>
    </div>

    <!-- Email -->
    <div>
      <input 
        class="w-full rounded-lg border p-3" 
        placeholder="Email *" 
        type="email" 
        name="email" 
        required
      />
      <p class="text-red-500 text-sm hidden">Valid email is required.</p>
    </div>

    <!-- Phone Number -->
    <input 
      class="w-full rounded-lg border p-3" 
      placeholder="Phone Number" 
      type="tel" 
      name="phone"
    />

    <!-- Company Name -->
    <input 
      class="w-full rounded-lg border p-3" 
      placeholder="Company Name" 
      name="company"
    />

    <!-- Message -->
    <div>
      <textarea 
        class="w-full rounded-lg border p-3" 
        placeholder="Message *" 
        rows="5" 
        name="message" 
        required
      ></textarea>
      <p class="text-red-500 text-sm hidden">Message is required.</p>
    </div>

    <!-- Submit Button -->
    <button 
      class="rounded-lg bg-blue-600 px-5 py-3 text-white hover:bg-blue-700" 
      type="submit"
    >
      Send
    </button>
  </form>

  <!-- Validation + EmailJS Script -->
  <script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("contactForm");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        let valid = true;
        const fields = form.querySelectorAll("[required]");
        
        fields.forEach((field) => {
          const errorMsg = field.nextElementSibling;
          if (!field.value.trim() || (field.type === "email" && !field.value.includes("@"))) {
            field.classList.add("border-red-500");
            if (errorMsg) errorMsg.classList.remove("hidden");
            valid = false;
          } else {
            field.classList.remove("border-red-500");
            if (errorMsg) errorMsg.classList.add("hidden");
          }
        });

        if (!valid) return;

        // ðŸ”¹ EmailJS integration
        try {
          // Replace with your EmailJS credentials
          const serviceID = "your_service_id";
          const templateID = "your_template_id";
          const publicKey = "your_public_key";

          const templateParams = {
            firstName: form.firstName.value,
            lastName: form.lastName.value,
            email: form.email.value,
            phone: form.phone.value,
            company: form.company.value,
            message: form.message.value,
          };

          const response = await emailjs.send(serviceID, templateID, templateParams, publicKey);

          alert("Message sent successfully!");
          form.reset();
        } catch (err) {
          alert("Failed to send message. Please try again later.");
          console.error(err);
        }
      });
    });
  </script>

  <!-- Load EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</BaseLayout>